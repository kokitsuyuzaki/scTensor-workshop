<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>細胞間相互作用解析ワークショップ: Cell-cell Interaction Analysis Workshop • scTensorWorkshop</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="細胞間相互作用解析ワークショップ: Cell-cell Interaction Analysis Workshop">
<meta property="og:description" content="scTensorWorkshop">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scTensorWorkshop</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/scTensor_workshop.html">細胞間相互作用解析ワークショップ: Cell-cell Interaction Analysis Workshop</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/kokitsuyuzaki/scTensor-workshop">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="scTensor_workshop_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>細胞間相互作用解析ワークショップ: Cell-cell Interaction Analysis Workshop</h1>
                        <h4 class="author">露崎 弘毅（Koki Tsuyuzaki）</h4>
            <address class="author_afil">
      Laboratory for Bioinformatics Research, RIKEN Center for Biosystems Dynamics Research, JapanPRESTO, Japan Science and Technology Agency, Japan<br><a class="author_email" href="mailto:#"></a><a href="mailto:k.t.the-answer@hotmail.co.jp" class="email">k.t.the-answer@hotmail.co.jp</a>
      </address>
                  
      
      <small class="dont-index">Source: <a href="https://github.com/kokitsuyuzaki/scTensorWorkshop/blob/master/vignettes/scTensor_workshop.Rmd"><code>vignettes/scTensor_workshop.Rmd</code></a></small>
      <div class="hidden name"><code>scTensor_workshop.Rmd</code></div>

    </div>

    
    
<p><img src="../inst/images/sctensor.png" width="120" height="130"><img src="../inst/images/lrbasedbi.png" width="120" height="130"><img src="../inst/images/rtensor.png" width="120" height="130"><img src="../inst/images/nntensor.png" width="120" height="130"><img src="../inst/images/delayedtensor.png" width="120" height="130"><img src="../inst/images/mwtensor.png" width="120" height="130"></p>
<div id="description" class="section level2">
<h2 class="hasAnchor">
<a href="#description" class="anchor"></a>Description</h2>
<p>In this workshop (presented in Japanese), you will learn how to detect cell-cell interaction from single-cell RNA-sequencing (scRNA-Seq) data using <code>scTensor</code> package. Moreover, you will learn some tensor frameworks of R language and will be able to freely use and decompose your original tensor data.</p>
<p>Expectation: In the first half, you will learn how to use <code>SingleCellExperiment</code> object, transform the scRNA-Seq data to higher-order tensor, and apply <code>scTensor</code> against it. In the latter half, you will learn some tensor-related R packages.</p>
<p>Pre-requisites: The course is aimed at PhD students, Master’s students, and third &amp; fourth year undergraduate students. Some basic R knowledge is assumed - this is not an introduction to R course. If you are not familiar with the R statistical programming language it is compulsory that you work through an introductory R course before you attend this workshop.</p>
</div>
<div id="participation" class="section level2">
<h2 class="hasAnchor">
<a href="#participation" class="anchor"></a>Participation</h2>
<p>After the lecture, participants are expected to follow along the hands-on session. we highly recommend participants bringing your own laptop.</p>
<div id="r-bioconductor-cran-packages-used" class="section level3">
<h3 class="hasAnchor">
<a href="#r-bioconductor-cran-packages-used" class="anchor"></a><em>R</em> / <em>Bioconductor</em> / <em>CRAN</em> packages used</h3>
<p>The following R/Bioconductor packages will be explicitly used:</p>
<p>List any <em>R</em> / <em>Bioconductor</em> / <em>CRAN</em> packages that will be explicitly covered.</p>
<ul>
<li>SingleCellExperiment (Bioconductor)</li>
<li>AnnotationHub (Bioconductor)</li>
<li>LRBaseDbi (Bioconductor)</li>
<li>scTensor (Bioconductor)</li>
<li>einsum (CRAN)</li>
<li>rTensor (CRAN)</li>
<li>nnTensor (CRAN)</li>
<li>HDF5Array (Bioconductor)</li>
<li>DelayedArray (Bioconductor)</li>
<li>DelayedTensor (Bioconductor)</li>
<li>mwTensor (CRAN)</li>
</ul>
</div>
</div>
<div id="time-outline" class="section level2">
<h2 class="hasAnchor">
<a href="#time-outline" class="anchor"></a>Time outline</h2>
<table class="table">
<thead><tr class="header">
<th>Activity</th>
<th>Time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Cell-cell Interaction Analysis by scTensor</td>
<td>20m</td>
</tr>
<tr class="even">
<td>Advanced Topics about Tensor Arithmetic and Decomposition</td>
<td>30m</td>
</tr>
<tr class="odd">
<td>Q &amp; A</td>
<td>10m</td>
</tr>
</tbody>
</table>
</div>
<div id="cell-cell-interaction-analysis-by-sctensor" class="section level2">
<h2 class="hasAnchor">
<a href="#cell-cell-interaction-analysis-by-sctensor" class="anchor"></a>Cell-cell Interaction Analysis by scTensor</h2>
<div id="sctensor" class="section level3">
<h3 class="hasAnchor">
<a href="#sctensor" class="anchor"></a>scTensor</h3>
<p>In this workshop, we will use the following data pre-prepared in the <code>scTensor</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"scTensor"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">GermMale</span><span class="op">)</span> <span class="co"># Matrix (242 genes x 852 cells)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">labelGermMale</span><span class="op">)</span> <span class="co"># Vector (852 cells)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">tsneGermMale</span><span class="op">)</span> <span class="co"># Output object of Rtsne (852 cells x 2 coordinates)</span></code></pre></div>
<p><code>scTensor</code> assumes that the row names in the expression level matrix are NCBI Gene IDs. If you use a different type of Gene ID (Ensembl ID, Gencode ID, Symbol …etc.), please convert them to NCBI Gene IDs according to the following document. <a href="https://www.bioconductor.org/packages/release/bioc/vignettes/scTensor/inst/doc/scTensor_1_Data_format_ID_Conversion.html">Roadmap to prepare the input matrix for scTensor</a></p>
</div>
<div id="singlecellexperiment" class="section level3">
<h3 class="hasAnchor">
<a href="#singlecellexperiment" class="anchor"></a>SingleCellExperiment</h3>
<p>First, we will convert <code>GermMale</code> to a <code>SingleCellExperiment</code> object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"SingleCellExperiment"</span><span class="op">)</span>

<span class="va">sce</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/SingleCellExperiment.html">SingleCellExperiment</a></span><span class="op">(</span>assays<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">GermMale</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The coordinates of t-SNE are assigned in the <code>SingleCellExperiment</code> object using the <code>reducedDims</code> function. This information will be used later in the report.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html">reducedDims</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">SimpleList</span><span class="op">(</span>TSNE<span class="op">=</span><span class="va">tsneGermMale</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></code></pre></div>
<p>The following process is optional, but if you want to assign the normalized expression amount into the <code>SingleCellExperiment</code> object, you can use the <code>normcounts</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CPMED</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span><span class="op">)</span><span class="op">{</span>
    <span class="va">libsize</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">libsize</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span> <span class="op">/</span> <span class="va">libsize</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">normcounts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="fu">CPMED</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/assays.html">counts</a></span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="annotationhub" class="section level3">
<h3 class="hasAnchor">
<a href="#annotationhub" class="anchor"></a>AnnotationHub</h3>
<p>This is the new feature since BioC 3.13. In earlier versions of BioC, an annotation package (<code>LRBase.XXX.eg.db</code>) containing the ligand-receptor pair database (<code>LRBase</code>) was required in addition to the user’s expression level matrix to perform scTensor.</p>
<p>Since BioC 3.13, these various annotation packages have been discontinued. Instead, the relevant data are placed on a remote server called <code>AnnotationHub</code>, and the policy has been changed so that the data are downloaded only when the user needs them.</p>
<p>The relevant data can be obtained as follows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"AnnotationHub"</span><span class="op">)</span>

<span class="va">ah</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">AnnotationHub</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">dbfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">query</a></span><span class="op">(</span><span class="va">ah</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"LRBaseDb"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Homo sapiens"</span>, <span class="st">"v002"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>The downloaded file will be stored on the local machine as a cached file by the <code>BiocFileCache</code> mechanism, so that the next time the data is needed, the data will be retrieved from the cache instead of from the server.</p>
</div>
<div id="lrbasedbi" class="section level3">
<h3 class="hasAnchor">
<a href="#lrbasedbi" class="anchor"></a>LRBaseDbi</h3>
<p><code>dbfile</code> is a string that indicates the path of the cache file (SQLite). By using <code>LRBaseDb</code>, this file can be converted into an <code>LRBaseDb</code> object and used in <code>scTensor</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"LRBaseDbi"</span><span class="op">)</span>

<span class="va">LRBase.Hsa.eg.db</span> <span class="op">&lt;-</span> <span class="fu">LRBaseDbi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/LRBaseDbi/man/LRBaseDb.html">LRBaseDb</a></span><span class="op">(</span><span class="va">dbfile</span><span class="op">)</span></code></pre></div>
</div>
<div id="sctensor-1" class="section level3">
<h3 class="hasAnchor">
<a href="#sctensor-1" class="anchor"></a>scTensor</h3>
<div id="real-dataset" class="section level4">
<h4 class="hasAnchor">
<a href="#real-dataset" class="anchor"></a>Real dataset</h4>
<p>For real single-cell RNA-Seq data, <code>scTensor</code> is executed as follows. First, use the <code>cellCellSetting</code> function to assign the prepared <code>LRBaseDb</code> object above to the metadata of <code>SingleCellExperiment</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/cellCellSetting.html">cellCellSetting</a></span><span class="op">(</span><span class="va">sce</span>, <span class="va">LRBase.Hsa.eg.db</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">labelGermMale</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="fu">metadata</span><span class="op">(</span><span class="va">sce</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ lrbase     : chr "/github/home/.cache/R/AnnotationHub/1307b73a2e63f_104518"</span>
<span class="co">#&gt;  $ ahid       : chr "AH97772"</span>
<span class="co">#&gt;  $ lr.evidence: chr "known"</span>
<span class="co">#&gt;  $ label      : chr [1:852] "Male_FGC_1" "Male_FGC_1" "Male_FGC_1" "Male_FGC_1" ...</span>
<span class="co">#&gt;  $ color      : chr [1:852] "#F8766D" "#F8766D" "#F8766D" "#F8766D" ...</span></code></pre></div>
<p>In the following, we will use <code>cellCellRanks</code> for searching rank parameters that can reduce the reconstruction error to some extent.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rks <span class="ot">&lt;-</span> <span class="fu">cellCellRanks</span>(sce, <span class="at">assayNames=</span><span class="st">"normcounts"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Each rank, multiple NMF runs are performed</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========</span>                                                            <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================</span>                                                  <span class="er">|</span>  <span class="dv">29</span>%</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================</span>                    <span class="er">|</span>  <span class="dv">71</span>%</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================================</span>          <span class="er">|</span>  <span class="dv">86</span>%</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Each rank estimation method</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========</span>                                                            <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================</span>                                                  <span class="er">|</span>  <span class="dv">29</span>%</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================</span>                    <span class="er">|</span>  <span class="dv">71</span>%</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================================</span>          <span class="er">|</span>  <span class="dv">86</span>%</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Each rank, multiple NMF runs are performed</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========</span>                                                            <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================</span>                                                  <span class="er">|</span>  <span class="dv">29</span>%</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================</span>                    <span class="er">|</span>  <span class="dv">71</span>%</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================================</span>          <span class="er">|</span>  <span class="dv">86</span>%</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Each rank estimation method</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========</span>                                                            <span class="er">|</span>  <span class="dv">14</span>%</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  <span class="er">|====================</span>                                                  <span class="er">|</span>  <span class="dv">29</span>%</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============================</span>                                        <span class="er">|</span>  <span class="dv">43</span>%</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================</span>                              <span class="er">|</span>  <span class="dv">57</span>%</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==================================================</span>                    <span class="er">|</span>  <span class="dv">71</span>%</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================================================</span>          <span class="er">|</span>  <span class="dv">86</span>%</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span></code></pre></div>
<p>The <code>cellCellDecomp</code> function performs non-negative tensor decomposition (see below) to detect ternary relationships (ligand-expressing cell type <span class="math inline">\(\times\)</span> receptor-expressing cell type <span class="math inline">\(\times\)</span> ligand-receptor pair) in the data in a data-driven manner.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/cellCellDecomp.html">cellCellDecomp</a></span><span class="op">(</span><span class="va">sce</span>, ranks<span class="op">=</span><span class="va">rks</span><span class="op">$</span><span class="va">selected</span>, assayNames<span class="op">=</span><span class="st">"normcounts"</span><span class="op">)</span></code></pre></div>
<p>The extracted ternary relations can be viewed in an HTML report using the <code>cellCellReport</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tmpdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/cellCellReport.html">cellCellReport</a></span><span class="op">(</span><span class="va">sce</span>, reducedDimNames<span class="op">=</span><span class="st">"TSNE"</span>, out.dir<span class="op">=</span><span class="va">tmpdir</span>,
    assayNames<span class="op">=</span><span class="st">"normcounts"</span>,
    title<span class="op">=</span><span class="st">"Cell-cell interaction within Germline_Male, GSE86146"</span>,
    author<span class="op">=</span><span class="st">"Koki Tsuyuzaki"</span>, html.open<span class="op">=</span><span class="cn">FALSE</span>, upper<span class="op">=</span><span class="fl">2</span>,
    goenrich<span class="op">=</span><span class="cn">TRUE</span>, meshenrich<span class="op">=</span><span class="cn">FALSE</span>, reactomeenrich<span class="op">=</span><span class="cn">FALSE</span>,
    doenrich<span class="op">=</span><span class="cn">FALSE</span>, ncgenrich<span class="op">=</span><span class="cn">FALSE</span>, dgnenrich<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; GO-Enrichment Analysis is running...(1/3)</span>
<span class="co">#&gt; GO-Enrichment Analysis is running...(2/3)</span>
<span class="co">#&gt; GO-Enrichment Analysis is running...(3/3)</span>
<span class="co">#&gt; Hyper-links are embedded...</span>
<span class="co">#&gt; GO-Enrichment Analysis is running...(1/3)</span>
<span class="co">#&gt; GO-Enrichment Analysis is running...(2/3)</span>
<span class="co">#&gt; GO-Enrichment Analysis is running...(3/3)</span>
<span class="co">#&gt; Hyper-links are embedded...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; pattern_3_1.Rmd is created...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; pattern_1_2.Rmd is created...</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">tmpdir</span><span class="op">)</span>
<span class="co">#&gt;  [1] "BiocStyle"                       "figures"                        </span>
<span class="co">#&gt;  [3] "file1324b11011a8e"               "file1324b111510e"               </span>
<span class="co">#&gt;  [5] "file1324b1aab4c48"               "file1324b1fcb16c1"              </span>
<span class="co">#&gt;  [7] "file1324b24c95acd"               "file1324b26289d09"              </span>
<span class="co">#&gt;  [9] "file1324b285cefdf"               "file1324b31f867a1"              </span>
<span class="co">#&gt; [11] "file1324b37cc9772"               "file1324b38e417f2"              </span>
<span class="co">#&gt; [13] "file1324b4811055f.html"          "file1324b4c50cf8f"              </span>
<span class="co">#&gt; [15] "file1324b4c7e2cdd"               "file1324b5608bbdf"              </span>
<span class="co">#&gt; [17] "file1324b58bfe277"               "file1324b5cbcf583"              </span>
<span class="co">#&gt; [19] "file1324b609ef558"               "file1324b612d02bc"              </span>
<span class="co">#&gt; [21] "file1324b6275937c"               "file1324b637109c7"              </span>
<span class="co">#&gt; [23] "file1324b63dd1fee"               "file1324b64925231"              </span>
<span class="co">#&gt; [25] "file1324b64c8d206"               "file1324b6c1fcbd0"              </span>
<span class="co">#&gt; [27] "file1324b6c827918"               "file1324b6d311cde"              </span>
<span class="co">#&gt; [29] "file1324b7249c13a"               "file1324b72df6137"              </span>
<span class="co">#&gt; [31] "file1324b7a2b5610"               "file1324b7e5c53a8"              </span>
<span class="co">#&gt; [33] "file1324b7ee87f80"               "file1324bde9004d"               </span>
<span class="co">#&gt; [35] "index.html"                      "index.Rmd"                      </span>
<span class="co">#&gt; [37] "ligand_all.html"                 "ligand_all.Rmd"                 </span>
<span class="co">#&gt; [39] "ligand.html"                     "ligand.Rmd"                     </span>
<span class="co">#&gt; [41] "pattern_1_2.html"                "pattern_1_2.Rmd"                </span>
<span class="co">#&gt; [43] "pattern_3_1.html"                "pattern_3_1.Rmd"                </span>
<span class="co">#&gt; [45] "reanalysis.RData"                "receptor_all.html"              </span>
<span class="co">#&gt; [47] "receptor_all.Rmd"                "receptor.html"                  </span>
<span class="co">#&gt; [49] "receptor.Rmd"                    "rmarkdown-str1324b2637632.html" </span>
<span class="co">#&gt; [51] "rmarkdown-str1324b2aea1874.html" "rmarkdown-str1324b4219583a.html"</span>
<span class="co">#&gt; [53] "rmarkdown-str1324b4b6cdbcf.html" "rmarkdown-str1324b552ece4d.html"</span>
<span class="co">#&gt; [55] "rmarkdown-str1324b688348e2.html" "rmarkdown-str1324b6ba6e947.html"</span>
<span class="co">#&gt; [57] "rmarkdown-str1324b7537f7d4.html" "Workflow_2.png"</span></code></pre></div>
</div>
<div id="simulation-dataset" class="section level4">
<h4 class="hasAnchor">
<a href="#simulation-dataset" class="anchor"></a>Simulation dataset</h4>
<p>For quantitative benchmarking, <code>scTensor</code> also provides a simulator that generates simulation data. You can check or change settings such as the number of genes (<code>nGene</code>), the number of cells (<code>nCell</code>), and the mode of cell-cell interaction (<code>cciInfo</code>) using the <code>getParam</code> and <code>setParam</code> functions.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/newCCSParams.html">newCCSParams</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/getParam.html">getParam</a></span><span class="op">(</span><span class="va">params</span>, <span class="st">"nGene"</span><span class="op">)</span>
<span class="co">#&gt; [1] 1000</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/getParam.html">getParam</a></span><span class="op">(</span><span class="va">params</span>, <span class="st">"nCell"</span><span class="op">)</span>
<span class="co">#&gt; [1] 50 50 50</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/getParam.html">getParam</a></span><span class="op">(</span><span class="va">params</span>, <span class="st">"cciInfo"</span><span class="op">)</span>
<span class="co">#&gt; $nPair</span>
<span class="co">#&gt; [1] 500</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI1</span>
<span class="co">#&gt; $CCI1$LPattern</span>
<span class="co">#&gt; [1] 1 0 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI1$RPattern</span>
<span class="co">#&gt; [1] 0 1 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI1$nGene</span>
<span class="co">#&gt; [1] 50</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI1$fc</span>
<span class="co">#&gt; [1] "E10"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI2</span>
<span class="co">#&gt; $CCI2$LPattern</span>
<span class="co">#&gt; [1] 0 1 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI2$RPattern</span>
<span class="co">#&gt; [1] 0 0 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI2$nGene</span>
<span class="co">#&gt; [1] 50</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI2$fc</span>
<span class="co">#&gt; [1] "E10"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI3</span>
<span class="co">#&gt; $CCI3$LPattern</span>
<span class="co">#&gt; [1] 0 0 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI3$RPattern</span>
<span class="co">#&gt; [1] 1 0 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI3$nGene</span>
<span class="co">#&gt; [1] 50</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $CCI3$fc</span>
<span class="co">#&gt; [1] "E10"</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/setParam.html">setParam</a></span><span class="op">(</span><span class="va">params</span>, <span class="st">"nGene"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/setParam.html">setParam</a></span><span class="op">(</span><span class="va">params</span>, <span class="st">"nCell"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/setParam.html">setParam</a></span><span class="op">(</span><span class="va">params</span>, <span class="st">"cciInfo"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    nPair<span class="op">=</span><span class="fl">50</span>,
    CCI1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>LPattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
        RPattern<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,
        nGene<span class="op">=</span><span class="fl">10</span>, fc<span class="op">=</span><span class="st">"E10"</span><span class="op">)</span><span class="op">)</span>

<span class="va">out_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scTensor/man/cellCellSimulate.html">cellCellSimulate</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">out_sim</span><span class="op">$</span><span class="va">input</span><span class="op">)</span>
<span class="co">#&gt;  num [1:100, 1:30] 0 1139 0 2 13607 ...</span>
<span class="co">#&gt;  - attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   ..$ : chr [1:100] "Gene1" "Gene2" "Gene3" "Gene4" ...</span>
<span class="co">#&gt;   ..$ : chr [1:30] "Cell1" "Cell2" "Cell3" "Cell4" ...</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">out_sim</span><span class="op">$</span><span class="va">LR</span><span class="op">)</span>
<span class="co">#&gt; 'data.frame':    50 obs. of  2 variables:</span>
<span class="co">#&gt;  $ GENEID_L: chr  "Gene1" "Gene2" "Gene3" "Gene4" ...</span>
<span class="co">#&gt;  $ GENEID_R: chr  "Gene11" "Gene12" "Gene13" "Gene14" ...</span>
<span class="va">geneL</span> <span class="op">&lt;-</span> <span class="va">out_sim</span><span class="op">$</span><span class="va">LR</span><span class="op">[</span>,<span class="st">"GENEID_L"</span><span class="op">]</span>
<span class="va">geneR</span> <span class="op">&lt;-</span> <span class="va">out_sim</span><span class="op">$</span><span class="va">LR</span><span class="op">[</span>,<span class="st">"GENEID_R"</span><span class="op">]</span>
<span class="va">L</span> <span class="op">&lt;-</span> <span class="va">out_sim</span><span class="op">$</span><span class="va">input</span><span class="op">[</span><span class="va">geneL</span>, <span class="op">]</span> <span class="co"># 50genes × 30cells</span>
<span class="va">R</span> <span class="op">&lt;-</span> <span class="va">out_sim</span><span class="op">$</span><span class="va">input</span><span class="op">[</span><span class="va">geneR</span>, <span class="op">]</span> <span class="co"># 50genes × 30cells</span></code></pre></div>
<p>In the next section, we will use these matrices of ligand and receptor gene expression levels (<code>L</code> and <code>R</code>).</p>
</div>
</div>
</div>
<div id="advanced-topics" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-topics" class="anchor"></a>Advanced Topics</h2>
<p>The following subsections are advanced topics for the software developers who want to develop the novel methodologies to detect CCI or who are interested in tensor decomposition.</p>
<p>The tools introduced in the following sections will be very useful for performing tensor decomposition in R in the future.</p>
<div id="einsum" class="section level3">
<h3 class="hasAnchor">
<a href="#einsum" class="anchor"></a>einsum</h3>
<p>Here I describes what is actually done inside <code>scTensor</code>.</p>
<p>After <code>L</code> (ligand) and <code>R</code> (receptor) are extracted from the gene expression matrix, the outer product is calculated and the result become a third-order tensor.</p>
<p>This process is easily calculated by <code>einsum</code> as follows.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"einsum"</span><span class="op">)</span>

<span class="va">CCItensor</span> <span class="op">&lt;-</span> <span class="fu">einsum</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/einsum/man/einsum.html">einsum</a></span><span class="op">(</span><span class="st">'ij,kj-&gt;ikj'</span>, <span class="va">L</span>, <span class="va">R</span><span class="op">)</span></code></pre></div>
<p><code>einsum</code> is the sugar syntax for the <code>for</code> statement.</p>
<p>In other words, it does exactly the same thing as executing the following <code>for</code> statement as follows.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">CCItensor2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fl">0</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
        <span class="kw">for</span><span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
            <span class="va">CCItensor2</span><span class="op">[</span><span class="va">i</span>,<span class="va">k</span>,<span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">L</span><span class="op">[</span><span class="va">i</span>,<span class="va">j</span><span class="op">]</span> <span class="op">*</span> <span class="va">R</span><span class="op">[</span><span class="va">k</span>,<span class="va">j</span><span class="op">]</span>
        <span class="op">}</span>
    <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">CCItensor</span>, <span class="va">CCItensor2</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>However, using <code>einsum</code>, the code become shorter and simpler. Besides, since <code>einsum</code> converts the R code into C++ code once and then executes it, it can be faster code.</p>
<p>Originally, <code>einsum</code> is implemented in <code>numpy</code> package of Python language and recently it is also implemented as an R/CRAN package.</p>
<p>In the process of combining multiple tensors into a single tensor, <code>einsum</code> is a very powerful tool and should be used.</p>
<p>For the details, check these documents of <a href="https://const-ae.github.io/einsum/index.html">einsum</a>.</p>
</div>
<div id="rtensor" class="section level3">
<h3 class="hasAnchor">
<a href="#rtensor" class="anchor"></a>rTensor</h3>
<p>Tensors are not just multidimensional arrays, because there are uniqu operations for tensors, such as matricizing, slice, and mode product, and such operations are not provided in the standard R array. By converting the array to a <code>Tensor</code> object set by the <code>rTensor</code> package, such operations can be performed.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rikenbit/rTensor">"rTensor"</a></span><span class="op">)</span>

<span class="va">CCItensor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rTensor/man/as.tensor.html">as.tensor</a></span><span class="op">(</span><span class="va">CCItensor</span><span class="op">)</span>
<span class="fu">is</span><span class="op">(</span><span class="va">CCItensor</span><span class="op">)</span>
<span class="co">#&gt; [1] "Tensor"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">CCItensor</span><span class="op">@</span><span class="va">data</span><span class="op">)</span> <span class="co"># Array data</span>
<span class="co">#&gt;  num [1:50, 1:50, 1:30] 0 0 0 0 0 0 0 0 0 0 ...</span></code></pre></div>
<p>After the object conversion, for example, these operations can be performed.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rTensor/man/modeSum-methods.html">modeSum</a></span><span class="op">(</span><span class="va">CCItensor</span>, m<span class="op">=</span><span class="fl">1</span>, drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Summation in a mode</span>
<span class="co">#&gt; Numeric Tensor of 2 Modes</span>
<span class="co">#&gt; Modes:  50 30 </span>
<span class="co">#&gt; Data: </span>
<span class="co">#&gt;           [,1]      [,2]      [,3]      [,4]      [,5]     [,6]      [,7]</span>
<span class="co">#&gt; [1,]         0    612395         0         0         0  1019565         0</span>
<span class="co">#&gt; [2,]    343560    174970    325255   1831104   1521680  1563333    226495</span>
<span class="co">#&gt; [3,] 162572592  30707235 155601992 218053968 142961836  5437680 470747208</span>
<span class="co">#&gt; [4,]    687120 330955755  16002546    381480 233045292 93935922   6885448</span>
<span class="co">#&gt; [5,] 119009184 252044285    260204  10528848   1369512 24265647  23238387</span>
<span class="co">#&gt; [6,]         0         0         0         0         0        0         0</span>
<span class="co">#&gt;           [,8]      [,9]     [,10]     [,11]     [,12]     [,13]      [,14]</span>
<span class="co">#&gt; [1,]         0   1468545         0         0 199271712    786780      42412</span>
<span class="co">#&gt; [2,]    189072   1036620         0  27275540  64573238  29818962    1272360</span>
<span class="co">#&gt; [3,] 336879036 205250760 196167686  63493880 222830190 100432467  309819660</span>
<span class="co">#&gt; [4,]    189072  25051650 153920234 257373784    350126  30094335    3732256</span>
<span class="co">#&gt; [5,]  45849960  94073265 138916466  48782974 102236792 130920192   38552508</span>
<span class="co">#&gt; [6,]         0         0         0         0         0         0 2329818396</span>
<span class="co">#&gt;          [,15]    [,16]     [,17]    [,18]     [,19]     [,20]    [,21]</span>
<span class="co">#&gt; [1,]  10272192  5183318         0 12742548    243780         0        0</span>
<span class="co">#&gt; [2,] 221173134  3067678  76226592 13089284  76790700   2624832    37778</span>
<span class="co">#&gt; [3,] 426937980 69816120 199863534 40394744   5444420 301439040 31620186</span>
<span class="co">#&gt; [4,]  66341240   423128  34690500 12959258 404187240     83328  2908906</span>
<span class="co">#&gt; [5,]  27392512 61776688  44403840  3727412  53062780  21998592 23837918</span>
<span class="co">#&gt; [6,]    642012        0   5781750   173368 282175350         0   113334</span>
<span class="co">#&gt;          [,22]     [,23]     [,24]     [,25]    [,26]    [,27]    [,28]</span>
<span class="co">#&gt; [1,]         0         0         0     97538        0    90158        0</span>
<span class="co">#&gt; [2,]         0   4510730    461772    341383   287715    45079   166095</span>
<span class="co">#&gt; [3,]  50434227 113090445 310541670 169813658 30958134 19519207 40194990</span>
<span class="co">#&gt; [4,]  21852774  44720666         0   1219225  1381032 50082769  5979420</span>
<span class="co">#&gt; [5,] 211058289 192865927  70766559   2779833 21118281 22990290 48101112</span>
<span class="co">#&gt; [6,]    370386         0         0         0        0        0        0</span>
<span class="co">#&gt;         [,29]     [,30]</span>
<span class="co">#&gt; [1,]        0    160285</span>
<span class="co">#&gt; [2,]   833152    384684</span>
<span class="co">#&gt; [3,]  1412736     96171</span>
<span class="co">#&gt; [4,]   833152 270625194</span>
<span class="co">#&gt; [5,] 14924288  32537855</span>
<span class="co">#&gt; [6,]        0         0</span>
<span class="fu">rTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rTensor/man/cs_unfold-methods.html">cs_unfold</a></span><span class="op">(</span><span class="va">CCItensor</span>, m<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="co"># Matricizing</span>
<span class="co">#&gt; Numeric Tensor of 2 Modes</span>
<span class="co">#&gt; Modes:  1500 50 </span>
<span class="co">#&gt; Data: </span>
<span class="co">#&gt;      [,1]    [,2] [,3] [,4]     [,5]    [,6]  [,7]    [,8] [,9] [,10]    [,11]</span>
<span class="co">#&gt; [1,]    0       0    0    0        0       0     0       0    0     0        0</span>
<span class="co">#&gt; [2,]    0    5695    0   10    68035    4015   100    6270    0   140    74150</span>
<span class="co">#&gt; [3,]    0 2694874    0 4732 32194162 1899898 47320 2966964    0 66248 35087780</span>
<span class="co">#&gt; [4,]    0   11390    0   20   136070    8030   200   12540    0   280   148300</span>
<span class="co">#&gt; [5,]    0 1972748    0 3464 23567324 1390796 34640 2171928    0 48496 25685560</span>
<span class="co">#&gt; [6,]    0       0    0    0        0       0     0       0    0     0        0</span>
<span class="co">#&gt;       [,12]   [,13]   [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22]</span>
<span class="co">#&gt; [1,]      0       0       0     0     0     0     0     0     0     0     0</span>
<span class="co">#&gt; [2,]    220    2140    5020     0     0     0     0     0     0     0    55</span>
<span class="co">#&gt; [3,] 104104 1012648 2375464     0     0     0     0     0     0     0 26026</span>
<span class="co">#&gt; [4,]    440    4280   10040     0     0     0     0     0     0     0   110</span>
<span class="co">#&gt; [5,]  76208  741296 1738928     0     0     0     0     0     0     0 19052</span>
<span class="co">#&gt; [6,]      0       0       0     0     0     0     0     0     0     0     0</span>
<span class="co">#&gt;       [,23] [,24] [,25] [,26] [,27]  [,28] [,29] [,30] [,31] [,32] [,33] [,34]</span>
<span class="co">#&gt; [1,]      0     0     0     0     0      0     0     0     0     0     0     0</span>
<span class="co">#&gt; [2,]   1110     0     0     5     0    290     0     0    95    40     0    25</span>
<span class="co">#&gt; [3,] 525252     0     0  2366     0 137228     0     0 44954 18928     0 11830</span>
<span class="co">#&gt; [4,]   2220     0     0    10     0    580     0     0   190    80     0    50</span>
<span class="co">#&gt; [5,] 384504     0     0  1732     0 100456     0     0 32908 13856     0  8660</span>
<span class="co">#&gt; [6,]      0     0     0     0     0      0     0     0     0     0     0     0</span>
<span class="co">#&gt;       [,35] [,36] [,37]  [,38]   [,39]  [,40] [,41] [,42]    [,43] [,44] [,45]</span>
<span class="co">#&gt; [1,]      0     0     0      0       0      0     0     0        0     0     0</span>
<span class="co">#&gt; [2,]    385   110     5   1440    8265    765     0    35    96975     0     0</span>
<span class="co">#&gt; [3,] 182182 52052  2366 681408 3910998 361998     0 16562 45888570     0     0</span>
<span class="co">#&gt; [4,]    770   220    10   2880   16530   1530     0    70   193950     0     0</span>
<span class="co">#&gt; [5,] 133364 38104  1732 498816 2862996 264996     0 12124 33592140     0     0</span>
<span class="co">#&gt; [6,]      0     0     0      0       0      0     0     0        0     0     0</span>
<span class="co">#&gt;         [,46] [,47] [,48] [,49] [,50]</span>
<span class="co">#&gt; [1,]        0     0     0     0     0</span>
<span class="co">#&gt; [2,]    68115     0    40     5     5</span>
<span class="co">#&gt; [3,] 32232018     0 18928  2366  2366</span>
<span class="co">#&gt; [4,]   136230     0    80    10    10</span>
<span class="co">#&gt; [5,] 23595036     0 13856  1732  1732</span>
<span class="co">#&gt; [6,]        0     0     0     0     0</span>
<span class="fu">rTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rTensor/man/fnorm-methods.html">fnorm</a></span><span class="op">(</span><span class="va">CCItensor</span><span class="op">)</span> <span class="co"># Frobenius Norm</span>
<span class="co">#&gt; [1] 5713216031</span></code></pre></div>
<p>In <code>rTensor</code> package, various tensor operations and decomposition algorithms are implemented. For the further details, check the <a href="https://cran.r-project.org/web/packages/rTensor/rTensor.pdf">document</a>.</p>
</div>
<div id="nntensor" class="section level3">
<h3 class="hasAnchor">
<a href="#nntensor" class="anchor"></a>nnTensor</h3>
<p><code>nnTensor</code> is the engine of <code>scTensor</code>; this decomposes <code>CCItensor</code> into factor matrices to detect ternary relationships (ligand-expressing cell type <span class="math inline">\(\times\)</span> receptor-expressing cell type <span class="math inline">\(\times\)</span> ligand-receptor pair).</p>
<p>In <code>scTensor</code>, <code>NTD</code> function is used to perform non-negative Tucker decomposition.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/rikenbit/nnTensor">"nnTensor"</a></span><span class="op">)</span>

<span class="va">out_nn</span> <span class="op">&lt;-</span> <span class="fu">nnTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnTensor/man/NTD.html">NTD</a></span><span class="op">(</span><span class="va">CCItensor</span>, algorithm<span class="op">=</span><span class="st">"KL"</span>, rank<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Initialization step is running...</span>
<span class="co">#&gt; Iterative step is running...</span>
<span class="co">#&gt; 1 / 100 |Previous Error - Error| / Error = 3.9347114086062</span>
<span class="co">#&gt; 2 / 100 |Previous Error - Error| / Error = 0.00474019038585057</span>
<span class="co">#&gt; 3 / 100 |Previous Error - Error| / Error = 0.00335781659011498</span>
<span class="co">#&gt; 4 / 100 |Previous Error - Error| / Error = 0.00280985165204136</span>
<span class="co">#&gt; 5 / 100 |Previous Error - Error| / Error = 0.00251017056638138</span>
<span class="co">#&gt; 6 / 100 |Previous Error - Error| / Error = 0.00228533432376288</span>
<span class="co">#&gt; 7 / 100 |Previous Error - Error| / Error = 0.00209426420099103</span>
<span class="co">#&gt; 8 / 100 |Previous Error - Error| / Error = 0.00192900665525107</span>
<span class="co">#&gt; 9 / 100 |Previous Error - Error| / Error = 0.00178839668372766</span>
<span class="co">#&gt; 10 / 100 |Previous Error - Error| / Error = 0.00167155012265543</span>
<span class="co">#&gt; 11 / 100 |Previous Error - Error| / Error = 0.00157662894375384</span>
<span class="co">#&gt; 12 / 100 |Previous Error - Error| / Error = 0.00150086913252346</span>
<span class="co">#&gt; 13 / 100 |Previous Error - Error| / Error = 0.00144083954871918</span>
<span class="co">#&gt; 14 / 100 |Previous Error - Error| / Error = 0.00139274087696968</span>
<span class="co">#&gt; 15 / 100 |Previous Error - Error| / Error = 0.0013527630410883</span>
<span class="co">#&gt; 16 / 100 |Previous Error - Error| / Error = 0.00131751715695251</span>
<span class="co">#&gt; 17 / 100 |Previous Error - Error| / Error = 0.00128446737317214</span>
<span class="co">#&gt; 18 / 100 |Previous Error - Error| / Error = 0.0012521791012103</span>
<span class="co">#&gt; 19 / 100 |Previous Error - Error| / Error = 0.00122015059915259</span>
<span class="co">#&gt; 20 / 100 |Previous Error - Error| / Error = 0.00118807487742067</span>
<span class="co">#&gt; 21 / 100 |Previous Error - Error| / Error = 0.00115464414594678</span>
<span class="co">#&gt; 22 / 100 |Previous Error - Error| / Error = 0.00111651112434153</span>
<span class="co">#&gt; 23 / 100 |Previous Error - Error| / Error = 0.0010686302143384</span>
<span class="co">#&gt; 24 / 100 |Previous Error - Error| / Error = 0.00100710312683555</span>
<span class="co">#&gt; 25 / 100 |Previous Error - Error| / Error = 0.000933568265772964</span>
<span class="co">#&gt; 26 / 100 |Previous Error - Error| / Error = 0.000856979692528036</span>
<span class="co">#&gt; 27 / 100 |Previous Error - Error| / Error = 0.000789175917039781</span>
<span class="co">#&gt; 28 / 100 |Previous Error - Error| / Error = 0.000737384461499591</span>
<span class="co">#&gt; 29 / 100 |Previous Error - Error| / Error = 0.000701271129383109</span>
<span class="co">#&gt; 30 / 100 |Previous Error - Error| / Error = 0.000676098246304447</span>
<span class="co">#&gt; 31 / 100 |Previous Error - Error| / Error = 0.000656833998688037</span>
<span class="co">#&gt; 32 / 100 |Previous Error - Error| / Error = 0.000639933652268655</span>
<span class="co">#&gt; 33 / 100 |Previous Error - Error| / Error = 0.000623350228392556</span>
<span class="co">#&gt; 34 / 100 |Previous Error - Error| / Error = 0.000606044091449622</span>
<span class="co">#&gt; 35 / 100 |Previous Error - Error| / Error = 0.000587564218483466</span>
<span class="co">#&gt; 36 / 100 |Previous Error - Error| / Error = 0.000567793589747433</span>
<span class="co">#&gt; 37 / 100 |Previous Error - Error| / Error = 0.00054681106559603</span>
<span class="co">#&gt; 38 / 100 |Previous Error - Error| / Error = 0.000524816046052986</span>
<span class="co">#&gt; 39 / 100 |Previous Error - Error| / Error = 0.000502082266076344</span>
<span class="co">#&gt; 40 / 100 |Previous Error - Error| / Error = 0.000478923829523209</span>
<span class="co">#&gt; 41 / 100 |Previous Error - Error| / Error = 0.000455666608698968</span>
<span class="co">#&gt; 42 / 100 |Previous Error - Error| / Error = 0.000432623235470541</span>
<span class="co">#&gt; 43 / 100 |Previous Error - Error| / Error = 0.000410072344333856</span>
<span class="co">#&gt; 44 / 100 |Previous Error - Error| / Error = 0.000388244544534174</span>
<span class="co">#&gt; 45 / 100 |Previous Error - Error| / Error = 0.000367318026496679</span>
<span class="co">#&gt; 46 / 100 |Previous Error - Error| / Error = 0.000347421477070235</span>
<span class="co">#&gt; 47 / 100 |Previous Error - Error| / Error = 0.000328636858489784</span>
<span class="co">#&gt; 48 / 100 |Previous Error - Error| / Error = 0.000311001337209079</span>
<span class="co">#&gt; 49 / 100 |Previous Error - Error| / Error = 0.000294513186895619</span>
<span class="co">#&gt; 50 / 100 |Previous Error - Error| / Error = 0.000279141178911974</span>
<span class="co">#&gt; 51 / 100 |Previous Error - Error| / Error = 0.000264833957637318</span>
<span class="co">#&gt; 52 / 100 |Previous Error - Error| / Error = 0.000251527828770727</span>
<span class="co">#&gt; 53 / 100 |Previous Error - Error| / Error = 0.000239152914341682</span>
<span class="co">#&gt; 54 / 100 |Previous Error - Error| / Error = 0.00022763789488753</span>
<span class="co">#&gt; 55 / 100 |Previous Error - Error| / Error = 0.000216913502903171</span>
<span class="co">#&gt; 56 / 100 |Previous Error - Error| / Error = 0.00020691490448154</span>
<span class="co">#&gt; 57 / 100 |Previous Error - Error| / Error = 0.000197583113859719</span>
<span class="co">#&gt; 58 / 100 |Previous Error - Error| / Error = 0.000188865598009734</span>
<span class="co">#&gt; 59 / 100 |Previous Error - Error| / Error = 0.000180716234969947</span>
<span class="co">#&gt; 60 / 100 |Previous Error - Error| / Error = 0.000173094789676642</span>
<span class="co">#&gt; 61 / 100 |Previous Error - Error| / Error = 0.000165966065570033</span>
<span class="co">#&gt; 62 / 100 |Previous Error - Error| / Error = 0.000159298879332535</span>
<span class="co">#&gt; 63 / 100 |Previous Error - Error| / Error = 0.000153064989663745</span>
<span class="co">#&gt; 64 / 100 |Previous Error - Error| / Error = 0.000147238089515645</span>
<span class="co">#&gt; 65 / 100 |Previous Error - Error| / Error = 0.000141792945993392</span>
<span class="co">#&gt; 66 / 100 |Previous Error - Error| / Error = 0.000136704745182167</span>
<span class="co">#&gt; 67 / 100 |Previous Error - Error| / Error = 0.000131948672727111</span>
<span class="co">#&gt; 68 / 100 |Previous Error - Error| / Error = 0.000127499736981743</span>
<span class="co">#&gt; 69 / 100 |Previous Error - Error| / Error = 0.000123332821566919</span>
<span class="co">#&gt; 70 / 100 |Previous Error - Error| / Error = 0.000119422938970542</span>
<span class="co">#&gt; 71 / 100 |Previous Error - Error| / Error = 0.000115745646809435</span>
<span class="co">#&gt; 72 / 100 |Previous Error - Error| / Error = 0.000112277583293141</span>
<span class="co">#&gt; 73 / 100 |Previous Error - Error| / Error = 0.000108997077895907</span>
<span class="co">#&gt; 74 / 100 |Previous Error - Error| / Error = 0.000105884796562301</span>
<span class="co">#&gt; 75 / 100 |Previous Error - Error| / Error = 0.000102924387169031</span>
<span class="co">#&gt; 76 / 100 |Previous Error - Error| / Error = 0.000100103099620824</span>
<span class="co">#&gt; 77 / 100 |Previous Error - Error| / Error = 9.7412364938207e-05</span>
<span class="co">#&gt; 78 / 100 |Previous Error - Error| / Error = 9.48483280729312e-05</span>
<span class="co">#&gt; 79 / 100 |Previous Error - Error| / Error = 9.24123389387028e-05</span>
<span class="co">#&gt; 80 / 100 |Previous Error - Error| / Error = 9.0111414278268e-05</span>
<span class="co">#&gt; 81 / 100 |Previous Error - Error| / Error = 8.79586883798173e-05</span>
<span class="co">#&gt; 82 / 100 |Previous Error - Error| / Error = 8.59738721859307e-05</span>
<span class="co">#&gt; 83 / 100 |Previous Error - Error| / Error = 8.41837366865528e-05</span>
<span class="co">#&gt; 84 / 100 |Previous Error - Error| / Error = 8.26226260434308e-05</span>
<span class="co">#&gt; 85 / 100 |Previous Error - Error| / Error = 8.13329867462503e-05</span>
<span class="co">#&gt; 86 / 100 |Previous Error - Error| / Error = 8.03658687398802e-05</span>
<span class="co">#&gt; 87 / 100 |Previous Error - Error| / Error = 7.97813100159656e-05</span>
<span class="co">#&gt; 88 / 100 |Previous Error - Error| / Error = 7.96484547151238e-05</span>
<span class="co">#&gt; 89 / 100 |Previous Error - Error| / Error = 8.00451742557262e-05</span>
<span class="co">#&gt; 90 / 100 |Previous Error - Error| / Error = 8.1056862407617e-05</span>
<span class="co">#&gt; 91 / 100 |Previous Error - Error| / Error = 8.27739658991028e-05</span>
<span class="co">#&gt; 92 / 100 |Previous Error - Error| / Error = 8.52877112714808e-05</span>
<span class="co">#&gt; 93 / 100 |Previous Error - Error| / Error = 8.86834340017449e-05</span>
<span class="co">#&gt; 94 / 100 |Previous Error - Error| / Error = 9.30309699314542e-05</span>
<span class="co">#&gt; 95 / 100 |Previous Error - Error| / Error = 9.83718199672693e-05</span>
<span class="co">#&gt; 96 / 100 |Previous Error - Error| / Error = 0.000104703347019814</span>
<span class="co">#&gt; 97 / 100 |Previous Error - Error| / Error = 0.000111961181670887</span>
<span class="co">#&gt; 98 / 100 |Previous Error - Error| / Error = 0.000120002271089503</span>
<span class="co">#&gt; 99 / 100 |Previous Error - Error| / Error = 0.000128592377834705</span>
<span class="co">#&gt; 100 / 100 |Previous Error - Error| / Error = 0.000137402828424551</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">out_nn</span><span class="op">$</span><span class="va">A</span><span class="op">)</span> <span class="co"># Factor matrices</span>
<span class="co">#&gt; List of 3</span>
<span class="co">#&gt;  $ A1: num [1:3, 1:50] 0.007411 0.002896 0.000098 0.076669 0.020756 ...</span>
<span class="co">#&gt;  $ A2: num [1:4, 1:50] 1.42e-02 8.47e-10 8.61e-79 3.65e-17 1.67e-02 ...</span>
<span class="co">#&gt;  $ A3: num [1:5, 1:30] 6.27e-02 2.32e-29 8.03e-15 7.52e-02 5.45e-01 ...</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">out_nn</span><span class="op">$</span><span class="va">S</span><span class="op">)</span> <span class="co"># Core tensor</span>
<span class="co">#&gt; Formal class 'Tensor' [package "rTensor"] with 3 slots</span>
<span class="co">#&gt;   ..@ num_modes: int 3</span>
<span class="co">#&gt;   ..@ modes    : int [1:3] 3 4 5</span>
<span class="co">#&gt;   ..@ data     : num [1:3, 1:4, 1:5] 1.36e+08 1.46e+07 6.94e+07 4.03e+08 3.60e+07 ...</span></code></pre></div>
<p>In addition to <code>NTD</code>, various non-negative matrix and tensor decompositions are available in the <code>nnTensor</code> package. For the further details, check the <a href="https://cran.r-project.org/web/packages/rTensor/rTensor.pdf">document</a>.</p>
</div>
<div id="delayedtensor" class="section level3">
<h3 class="hasAnchor">
<a href="#delayedtensor" class="anchor"></a>DelayedTensor</h3>
<p>One disadvantage of tensors is that they tend to have a large data size. To compensate for this disadvantage, here I introduce <code>DelayedTensor</code> (to be released in BioC 3.14).</p>
<p>First, load the necessary related packages and configure them as follows.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.org/packages/HDF5Array">"HDF5Array"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://bioconductor.org/packages/DelayedArray">"DelayedArray"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st">"DelayedTensor"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>delayedtensor.sparse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># Sparse mode off</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>delayedtensor.verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Verbose message on</span>
<span class="fu"><a href="https://rdrr.io/pkg/HDF5Array/man/dump-management.html">setHDF5DumpCompressionLevel</a></span><span class="op">(</span>level<span class="op">=</span><span class="fl">9L</span><span class="op">)</span> <span class="co"># No compression inside of HDF5 file</span>
<span class="fu"><a href="https://rdrr.io/pkg/HDF5Array/man/dump-management.html">setHDF5DumpDir</a></span><span class="op">(</span><span class="va">tmpdir</span><span class="op">)</span> <span class="co"># Pass to save the temporary HDF5 files</span>
<span class="fu"><a href="https://rdrr.io/pkg/DelayedArray/man/AutoBlock-global-settings.html">setAutoBlockSize</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1E+7</span><span class="op">)</span> <span class="co"># Data size loaded on the memory at once</span></code></pre></div>
<p>After that, R standard matrix or array objects are converted to <code>DelayedArray</code> objects.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">darr_L</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DelayedArray/man/DelayedArray-class.html">DelayedArray</a></span><span class="op">(</span><span class="va">L</span><span class="op">)</span>
<span class="va">darr_R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DelayedArray/man/DelayedArray-class.html">DelayedArray</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span></code></pre></div>
<p><code>DelayedArray</code> provides the <em>lazy evaluation</em> that is computed when the data value is actually needed, and an <em>out-of-core</em> implementation that sequentially puts only a defined block size into memory and uses it for computation.</p>
<p>The <code>DelayedTensor</code> package attaches tensor arithmetic and tensor decomposition functions to <code>DelayedArray</code>, just like the relationship between R standard array and <code>rTensor</code> package.</p>
<p>For example, the <code>einsum</code> described above for <code>DelayedTensor</code> can also be performed for <code>DelayedArray</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">darr_CCItensor</span> <span class="op">&lt;-</span> <span class="fu">DelayedTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DelayedTensor/man/einsum.html">einsum</a></span><span class="op">(</span><span class="st">'ij,kj-&gt;ikj'</span>, <span class="va">darr_L</span>, <span class="va">darr_R</span><span class="op">)</span>
<span class="co">#&gt; \ Processing viewport 1/1 ... OK</span></code></pre></div>
<p>Also, various functions of <code>rTensor</code> have been re-implemented for <code>DelayedArray</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DelayedTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DelayedTensor/man/modeSum.html">modeSum</a></span><span class="op">(</span><span class="va">darr_CCItensor</span>, m<span class="op">=</span><span class="fl">1</span>, drop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; \ Processing viewport 1/1 ... OK</span>
<span class="co">#&gt; &lt;50 x 30&gt; matrix of class DelayedArray and type "double":</span>
<span class="co">#&gt;            [,1]      [,2]      [,3] ...     [,29]     [,30]</span>
<span class="co">#&gt;  [1,]         0    612395         0   .         0    160285</span>
<span class="co">#&gt;  [2,]    343560    174970    325255   .    833152    384684</span>
<span class="co">#&gt;  [3,] 162572592  30707235 155601992   .   1412736     96171</span>
<span class="co">#&gt;  [4,]    687120 330955755  16002546   .    833152 270625194</span>
<span class="co">#&gt;  [5,] 119009184 252044285    260204   .  14924288  32537855</span>
<span class="co">#&gt;   ...         .         .         .   .         .         .</span>
<span class="co">#&gt; [46,]         0         0         0   .     36224         0</span>
<span class="co">#&gt; [47,]   3504312   6123950   4163264   .   2825472   2564560</span>
<span class="co">#&gt; [48,]   2061360    699880         0   .         0         0</span>
<span class="co">#&gt; [49,]   2404920   2274610  12489792   .    615808         0</span>
<span class="co">#&gt; [50,]         0         0         0   .    144896         0</span>
<span class="fu">DelayedTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DelayedTensor/man/cs_unfold.html">cs_unfold</a></span><span class="op">(</span><span class="va">darr_CCItensor</span>, m<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; \ Processing viewport 1/1 ... OK</span>
<span class="co">#&gt; &lt;1500 x 50&gt; matrix of class HDF5Matrix and type "double":</span>
<span class="co">#&gt;            [,1]    [,2]    [,3] ... [,49] [,50]</span>
<span class="co">#&gt;    [1,]       0       0       0   .     0     0</span>
<span class="co">#&gt;    [2,]       0    5695       0   .     5     5</span>
<span class="co">#&gt;    [3,]       0 2694874       0   .  2366  2366</span>
<span class="co">#&gt;    [4,]       0   11390       0   .    10    10</span>
<span class="co">#&gt;    [5,]       0 1972748       0   .  1732  1732</span>
<span class="co">#&gt;     ...       .       .       .   .     .     .</span>
<span class="co">#&gt; [1496,]       0       0       0   .     0     0</span>
<span class="co">#&gt; [1497,]       0   54480     160   .   560   480</span>
<span class="co">#&gt; [1498,]       0       0       0   .     0     0</span>
<span class="co">#&gt; [1499,]       0       0       0   .     0     0</span>
<span class="co">#&gt; [1500,]       0       0       0   .     0     0</span>
<span class="fu">DelayedTensor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DelayedTensor/man/fnorm.html">fnorm</a></span><span class="op">(</span><span class="va">darr_CCItensor</span><span class="op">)</span>
<span class="co">#&gt; [1] 5713216031</span></code></pre></div>
<p>For the details, check the <a href="https://www.bioconductor.org/packages/devel/bioc/html/DelayedTensor.html">document</a>.</p>
</div>
<div id="mwtensor" class="section level3">
<h3 class="hasAnchor">
<a href="#mwtensor" class="anchor"></a>mwTensor</h3>
<p>Finally, I will introduce <code>mwTensor</code>, an R/CRAN package that decomposes multiple tensors simultaneously. Most of the tensor decomposition algorithms extract patterns (factor matrices) by unfolding tensors into matrices form and then applying matrix decomposition algorithms such as PCA, NMF, or ICA. In the case of algorithms that decompose multiple tensors simultaneously, it is assumed that there is a common factor matrix between them.</p>
<p>The role of <code>mwTensor</code> is to describe such complex modeling as a parameter object so that users do not have to implement tensor decomposition from scratch.</p>
<p>In the following, I will show an example of decomposition of three tensors simultaneously.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"mwTensor"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>Xs <span class="ot">&lt;-</span> mwTensor<span class="sc">::</span><span class="fu">toyModel</span>(<span class="st">"coupled_CP_Easy"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">new</span>(<span class="st">"CoupledMWCAParams"</span>, <span class="at">Xs=</span>Xs, <span class="at">verbose=</span><span class="cn">TRUE</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>out_mw <span class="ot">&lt;-</span> <span class="fu">CoupledMWCA</span>(params)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Initialization step (Common Factor Matrices)...</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 / 5</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">/</span> <span class="dv">5</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>Initialization <span class="fu">step</span> (Common Core Tensors)...</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">1e-09</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.999999999999861</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.0215799691905186</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.0299110247139658</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.00624967589022661</span></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.0121811168270059</span></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.0148713410224235</span></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.00149373443071709</span></span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.0187432588156111</span></span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 / 5 Common factor matricies are being updated</span></span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span> Common factor matricies are being updated</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span> <span class="sc">/</span> <span class="dv">10</span> <span class="sc">|</span>Previous Error <span class="sc">-</span> Error<span class="sc">|</span> <span class="er">/</span> Error <span class="ot">=</span> <span class="fl">0.0298519512420506</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(out_mw<span class="sc">@</span>common_factors)</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 5</span></span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ A1: num [1:3, 1:20] -0.13791 -0.00783 -0.28287 -0.1406 -0.00803 ...</span></span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ A2: num [1:3, 1:30] -0.1734 -0.1525 0.0874 -0.173 -0.1511 ...</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ A3: num [1:5, 1:30] 0.00581 -0.40221 -0.01238 0.00196 0.01218 ...</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ A4: num [1:4, 1:30] -0.2934 -0.0279 -0.2704 -0.0699 -0.2942 ...</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ A5: num [1:4, 1:25] -0.2579 0.0721 -0.2674 0.0287 -0.2567 ...</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(out_mw<span class="sc">@</span>common_cores)</span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; List of 3</span></span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ :Formal class 'Tensor' [package "rTensor"] with 3 slots</span></span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ num_modes: int 2</span></span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ modes    : int [1:2] 3 3</span></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ data     : num [1:3, 1:3] -204 198 892 492 -305 ...</span></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ :Formal class 'Tensor' [package "rTensor"] with 3 slots</span></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ num_modes: int 3</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ modes    : int [1:3] 3 5 4</span></span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ data     : num [1:3, 1:5, 1:4] -907 908 727 -1143 349 ...</span></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  $ :Formal class 'Tensor' [package "rTensor"] with 3 slots</span></span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ num_modes: int 2</span></span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ modes    : int [1:2] 4 4</span></span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   .. ..@ data     : num [1:4, 1:4] 441.27 1.19 -14.58 15.7 -16.57 ...</span></span></code></pre></div>
</div>
</div>
<div id="session-information" class="section level2">
<h2 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session Information</h2>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.1.1 (2021-08-10)</span>
<span class="co">#&gt; Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co">#&gt; Running under: Ubuntu 20.04.3 LTS</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; BLAS/LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.8.so</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt;  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span>
<span class="co">#&gt;  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span>
<span class="co">#&gt;  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             </span>
<span class="co">#&gt;  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span>
<span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span>
<span class="co">#&gt; [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span>
<span class="co">#&gt; [8] base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] mwTensor_0.99.5             DelayedTensor_0.99.12      </span>
<span class="co">#&gt;  [3] HDF5Array_1.21.0            rhdf5_2.37.4               </span>
<span class="co">#&gt;  [5] DelayedArray_0.19.4         Matrix_1.3-4               </span>
<span class="co">#&gt;  [7] nnTensor_1.1.5              rTensor_1.4.8              </span>
<span class="co">#&gt;  [9] einsum_0.1.0                heatmaply_1.3.0            </span>
<span class="co">#&gt; [11] viridis_0.6.2               viridisLite_0.4.0          </span>
<span class="co">#&gt; [13] BiocStyle_2.21.4            plotly_4.10.0              </span>
<span class="co">#&gt; [15] ggplot2_3.3.5               AnnotationDbi_1.55.2       </span>
<span class="co">#&gt; [17] LRBaseDbi_2.3.1             AnnotationHub_3.1.6        </span>
<span class="co">#&gt; [19] BiocFileCache_2.1.1         dbplyr_2.1.1               </span>
<span class="co">#&gt; [21] SingleCellExperiment_1.15.2 SummarizedExperiment_1.23.5</span>
<span class="co">#&gt; [23] Biobase_2.53.0              GenomicRanges_1.45.0       </span>
<span class="co">#&gt; [25] GenomeInfoDb_1.29.10        IRanges_2.27.2             </span>
<span class="co">#&gt; [27] S4Vectors_0.31.5            BiocGenerics_0.39.2        </span>
<span class="co">#&gt; [29] MatrixGenerics_1.5.4        matrixStats_0.61.0         </span>
<span class="co">#&gt; [31] scTensor_2.3.4             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;   [1] rsvd_1.0.5                    ica_1.0-2                    </span>
<span class="co">#&gt;   [3] foreach_1.5.1                 lmtest_0.9-38                </span>
<span class="co">#&gt;   [5] rprojroot_2.0.2               crayon_1.4.1                 </span>
<span class="co">#&gt;   [7] spatstat.core_2.3-0           MASS_7.3-54                  </span>
<span class="co">#&gt;   [9] rhdf5filters_1.5.0            nlme_3.1-153                 </span>
<span class="co">#&gt;  [11] backports_1.2.1               GOSemSim_2.19.1              </span>
<span class="co">#&gt;  [13] MeSHDbi_1.29.2                rlang_0.4.12                 </span>
<span class="co">#&gt;  [15] XVector_0.33.0                ROCR_1.0-11                  </span>
<span class="co">#&gt;  [17] irlba_2.3.3                   filelock_1.0.2               </span>
<span class="co">#&gt;  [19] GOstats_2.59.1                BiocParallel_1.27.17         </span>
<span class="co">#&gt;  [21] tagcloud_0.6                  bit64_4.0.5                  </span>
<span class="co">#&gt;  [23] glue_1.4.2                    sctransform_0.3.2            </span>
<span class="co">#&gt;  [25] parallel_4.1.1                spatstat.sparse_2.0-0        </span>
<span class="co">#&gt;  [27] dotCall64_1.0-1               tcltk_4.1.1                  </span>
<span class="co">#&gt;  [29] DOSE_3.19.3                   spatstat.geom_2.3-0          </span>
<span class="co">#&gt;  [31] tidyselect_1.1.1              SeuratObject_4.0.2           </span>
<span class="co">#&gt;  [33] fitdistrplus_1.1-6            XML_3.99-0.8                 </span>
<span class="co">#&gt;  [35] tidyr_1.1.4                   zoo_1.8-9                    </span>
<span class="co">#&gt;  [37] xtable_1.8-4                  magrittr_2.0.1               </span>
<span class="co">#&gt;  [39] evaluate_0.14                 zlibbioc_1.39.0              </span>
<span class="co">#&gt;  [41] miniUI_0.1.1.1                bslib_0.3.1                  </span>
<span class="co">#&gt;  [43] rpart_4.1-15                  fastmatch_1.1-3              </span>
<span class="co">#&gt;  [45] treeio_1.17.2                 maps_3.4.0                   </span>
<span class="co">#&gt;  [47] fields_12.5                   shiny_1.7.1                  </span>
<span class="co">#&gt;  [49] BiocSingular_1.9.1            xfun_0.27                    </span>
<span class="co">#&gt;  [51] cluster_2.1.2                 tidygraph_1.2.0              </span>
<span class="co">#&gt;  [53] TSP_1.1-11                    KEGGREST_1.33.0              </span>
<span class="co">#&gt;  [55] tibble_3.1.5                  interactiveDisplayBase_1.31.2</span>
<span class="co">#&gt;  [57] ggrepel_0.9.1                 ape_5.5                      </span>
<span class="co">#&gt;  [59] listenv_0.8.0                 dendextend_1.15.1            </span>
<span class="co">#&gt;  [61] Biostrings_2.61.2             png_0.1-7                    </span>
<span class="co">#&gt;  [63] future_1.22.1                 withr_2.4.2                  </span>
<span class="co">#&gt;  [65] bitops_1.0-7                  ggforce_0.3.3                </span>
<span class="co">#&gt;  [67] RBGL_1.69.0                   plyr_1.8.6                   </span>
<span class="co">#&gt;  [69] GSEABase_1.55.2               dqrng_0.3.0                  </span>
<span class="co">#&gt;  [71] pillar_1.6.4                  cachem_1.0.6                 </span>
<span class="co">#&gt;  [73] fs_1.5.0                      graphite_1.39.3              </span>
<span class="co">#&gt;  [75] vctrs_0.3.8                   ellipsis_0.3.2               </span>
<span class="co">#&gt;  [77] generics_0.1.0                plot3D_1.4                   </span>
<span class="co">#&gt;  [79] outliers_0.14                 tools_4.1.1                  </span>
<span class="co">#&gt;  [81] entropy_1.3.1                 munsell_0.5.0                </span>
<span class="co">#&gt;  [83] tweenr_1.0.2                  fgsea_1.19.4                 </span>
<span class="co">#&gt;  [85] fastmap_1.1.0                 compiler_4.1.1               </span>
<span class="co">#&gt;  [87] abind_1.4-5                   httpuv_1.6.3                 </span>
<span class="co">#&gt;  [89] GenomeInfoDbData_1.2.7        gridExtra_2.3                </span>
<span class="co">#&gt;  [91] lattice_0.20-45               deldir_1.0-5                 </span>
<span class="co">#&gt;  [93] visNetwork_2.1.0              AnnotationForge_1.35.2       </span>
<span class="co">#&gt;  [95] utf8_1.2.2                    later_1.3.0                  </span>
<span class="co">#&gt;  [97] dplyr_1.0.7                   jsonlite_1.7.2               </span>
<span class="co">#&gt;  [99] ccTensor_1.0.2                concaveman_1.1.0             </span>
<span class="co">#&gt; [101] scales_1.1.1                  graph_1.71.2                 </span>
<span class="co">#&gt; [103] ScaledMatrix_1.1.0            tidytree_0.3.5               </span>
<span class="co">#&gt; [105] pbapply_1.5-0                 genefilter_1.75.1            </span>
<span class="co">#&gt; [107] lazyeval_0.2.2                promises_1.2.0.1             </span>
<span class="co">#&gt; [109] goftest_1.2-3                 spatstat.utils_2.2-0         </span>
<span class="co">#&gt; [111] reticulate_1.22               checkmate_2.0.0              </span>
<span class="co">#&gt; [113] rmarkdown_2.11                pkgdown_1.6.1                </span>
<span class="co">#&gt; [115] cowplot_1.1.1                 textshaping_0.3.6            </span>
<span class="co">#&gt; [117] schex_1.7.0                   webshot_0.5.2                </span>
<span class="co">#&gt; [119] Rtsne_0.15                    uwot_0.1.10                  </span>
<span class="co">#&gt; [121] igraph_1.2.7                  survival_3.2-13              </span>
<span class="co">#&gt; [123] yaml_2.2.1                    plotrix_3.8-2                </span>
<span class="co">#&gt; [125] systemfonts_1.0.3             htmltools_0.5.2              </span>
<span class="co">#&gt; [127] memoise_2.0.0                 Seurat_4.0.5                 </span>
<span class="co">#&gt; [129] seriation_1.3.1               graphlayouts_0.7.1           </span>
<span class="co">#&gt; [131] digest_0.6.28                 assertthat_0.2.1             </span>
<span class="co">#&gt; [133] ReactomePA_1.37.0             mime_0.12                    </span>
<span class="co">#&gt; [135] rappdirs_0.3.3                registry_0.5-1               </span>
<span class="co">#&gt; [137] spam_2.7-0                    RSQLite_2.2.8                </span>
<span class="co">#&gt; [139] yulab.utils_0.0.4             future.apply_1.8.1           </span>
<span class="co">#&gt; [141] misc3d_0.9-1                  data.table_1.14.2            </span>
<span class="co">#&gt; [143] blob_1.2.2                    ragg_1.1.3                   </span>
<span class="co">#&gt; [145] splines_4.1.1                 labeling_0.4.2               </span>
<span class="co">#&gt; [147] Rhdf5lib_1.15.2               RCurl_1.98-1.5               </span>
<span class="co">#&gt; [149] colorspace_2.0-2              BiocManager_1.30.16          </span>
<span class="co">#&gt; [151] aplot_0.1.1                   sass_0.4.0                   </span>
<span class="co">#&gt; [153] Rcpp_1.0.7                    bookdown_0.24                </span>
<span class="co">#&gt; [155] RANN_2.6.1                    enrichplot_1.13.2            </span>
<span class="co">#&gt; [157] fansi_0.5.0                   parallelly_1.28.1            </span>
<span class="co">#&gt; [159] R6_2.5.1                      grid_4.1.1                   </span>
<span class="co">#&gt; [161] ggridges_0.5.3                lifecycle_1.0.1              </span>
<span class="co">#&gt; [163] curl_4.3.2                    leiden_0.3.9                 </span>
<span class="co">#&gt; [165] meshr_1.99.2                  jquerylib_0.1.4              </span>
<span class="co">#&gt; [167] DO.db_2.9                     qvalue_2.25.0                </span>
<span class="co">#&gt; [169] desc_1.4.0                    RcppAnnoy_0.0.19             </span>
<span class="co">#&gt; [171] RColorBrewer_1.1-2            iterators_1.0.13             </span>
<span class="co">#&gt; [173] stringr_1.4.0                 htmlwidgets_1.5.4            </span>
<span class="co">#&gt; [175] beachmat_2.9.1                polyclip_1.10-0              </span>
<span class="co">#&gt; [177] purrr_0.3.4                   crosstalk_1.1.1              </span>
<span class="co">#&gt; [179] shadowtext_0.0.9              gridGraphics_0.5-1           </span>
<span class="co">#&gt; [181] reactome.db_1.77.0            mgcv_1.8-38                  </span>
<span class="co">#&gt; [183] globals_0.14.0                patchwork_1.1.1              </span>
<span class="co">#&gt; [185] codetools_0.2-18              GO.db_3.14.0                 </span>
<span class="co">#&gt; [187] DelayedRandomArray_1.1.0      gtable_0.3.0                 </span>
<span class="co">#&gt; [189] DBI_1.1.1                     ggfun_0.0.4                  </span>
<span class="co">#&gt; [191] tensor_1.5                    httr_1.4.2                   </span>
<span class="co">#&gt; [193] KernSmooth_2.23-20            stringi_1.7.5                </span>
<span class="co">#&gt; [195] reshape2_1.4.4                farver_2.1.0                 </span>
<span class="co">#&gt; [197] annotate_1.71.0               hexbin_1.28.2                </span>
<span class="co">#&gt; [199] fdrtool_1.2.16                Rgraphviz_2.37.2             </span>
<span class="co">#&gt; [201] ggtree_3.1.5                  ggplotify_0.1.0              </span>
<span class="co">#&gt; [203] Category_2.59.0               scattermore_0.7              </span>
<span class="co">#&gt; [205] BiocVersion_3.14.0            bit_4.0.4                    </span>
<span class="co">#&gt; [207] scatterpie_0.1.7              spatstat.data_2.1-0          </span>
<span class="co">#&gt; [209] ggraph_2.0.5                  pkgconfig_2.0.3              </span>
<span class="co">#&gt; [211] knitr_1.36</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Koki Tsuyuzaki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
